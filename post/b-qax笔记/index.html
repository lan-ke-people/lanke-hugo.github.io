<!doctype html><html lang=zh-cn data-theme-mode=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>QAX笔记 | 烂柯</title><meta name=description content="QAX笔记"><script>window.siteConfig=JSON.parse('{"anchor_icon":null,"base":"https://lan-ke-people.github.io/lanke-hugo.github.io/","clipboard":{"copyright":{"count":50,"enable":false,"license_type":"by-nc-sa"},"fail":{"en":"Copy failed (ﾟ⊿ﾟ)ﾂ","ja":"コピー失敗 (ﾟ⊿ﾟ)ﾂ","pt-br":"Falha ao copiar (ﾟ⊿ﾟ)ﾂ","zh-cn":"复制失败 (ﾟ⊿ﾟ)ﾂ","zh-tw":"複製失敗 (ﾟ⊿ﾟ)ﾂ"},"success":{"en":"Copy successfully (*^▽^*)","ja":"コピー成功 (*^▽^*)","pt-br":"Copiado com sucesso (*^▽^*)","zh-cn":"复制成功 (*^▽^*)","zh-tw":"複製成功 (*^▽^*)"}},"code_block":{"expand":true},"icon_font":"4552607_0khxww3tj3q9","outdate":{"daysago":180,"enable":false,"message":{"en":"This article was last updated on {time}. Please note that the content may no longer be applicable.","ja":"この記事は最終更新日：{time}。記載内容が現在有効でない可能性がありますのでご注意ください。","pt-br":"Este artigo foi atualizado pela última vez em {time}. Observe que o conteúdo pode não ser mais aplicável.","zh-cn":"本文最后更新于 {time}，请注意文中内容可能已不适用。","zh-tw":"本文最後更新於 {time}，請注意文中內容可能已不適用。"}}}')</script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7cNoto%20Serif%20SC:400,400italic,700,700italic%7c&amp;display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7cNoto%20Serif%20SC:400,400italic,700,700italic%7c&amp;display=swap" media=print onload='this.media="all"'><link rel=preload href=//at.alicdn.com/t/c/font_4552607_0khxww3tj3q9.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=stylesheet href=/lanke-hugo.github.io/css/loader.min.ac746e154f756f8220326eeb52a719f142ab038be5a8ddf30ea5ef15ef2356ea.css><meta property="og:type" content="website"><meta property="og:title" content="QAX笔记 | 烂柯"><meta property="og:description" content="QAX笔记"><meta property="og:url" content="https://lan-ke-people.github.io/lanke-hugo.github.io/post/b-qax%E7%AC%94%E8%AE%B0/"><meta property="og:site_name" content="烂柯的 Blog"><meta property="og:image" content="/lanke-hugo.github.io/"><meta property="article:author" content="烂柯"><meta property="article:published_time" content="2025-09-10T00:00:00+00:00"><meta property="article:modified_time" content="2025-12-04T00:00:00+00:00"><meta property="article:tag" content="work book"><meta name=twitter:card content="summary"><meta name=twitter:image content="/lanke-hugo.github.io/"><link rel="shortcut icon" href=/lanke-hugo.github.io/favicon.ico><link rel=stylesheet href=/lanke-hugo.github.io/css/main.min.7c658025c1fd976b0c2e36075723bdcd73b21ec9e36d071b9494be615af52024.css><link rel=preload as=style href=https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.css integrity=sha384-IfxC36XL/toUyJ939C73PcgMuRzAZuIzZxE38drsmO5p6jD7ei+Zx/1oA/0l8ysE crossorigin=anonymous onload='this.onload=null,this.rel="stylesheet"'><link rel=preload as=style href=https://npm.webcache.cn/katex@0.16.22/dist/katex.min.css integrity=sha384-5TcZemv2l/9On385z///+d7MSYlvIEw9FuZTIdZ14vJLqWphw7e7ZPuOiCHJcFCP crossorigin=anonymous onload='this.onload=null,this.rel="stylesheet"'><script src=https://npm.webcache.cn/pace-js@1.2.4/pace.min.js integrity=sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8 crossorigin=anonymous></script><link rel=stylesheet href=https://npm.webcache.cn/@reimujs/aos@0.1.2/dist/aos.css integrity=sha384-GMRP93c6Hkz9JVKGAuRR3nTS7M07RwPgTFenXiosjq2VbVgvdDNcz1g6Mkj8AONa crossorigin=anonymous></head><body><div id=loader><div class="loading-left-bg loading-bg"></div><div class="loading-right-bg loading-bg"></div><div class=spinner-box><div class="loading-taichi rotate"><svg width="150" height="150" viewBox="0 0 1024 1024" class="icon" shape-rendering="geometricPrecision"><path d="M303.5 432a80 80 0 01-12 160 80 80 0 0112-160z" fill="var(--red-1, #ff5252)"/><path d="M512 65a447 447 0 010 894V929a417 417 0 000-834 417 417 0 000 834v30a447 447 0 010-894zm0 30A417 417 0 01929 512 208.5 208.5.0 01720.5 720.5V592a80 80 0 000-160 80 80 0 000 160V720.5A208.5 208.5.0 01512 512 208.5 208.5.0 00303.5 303.5 208.5 208.5.0 0095 512 417 417 0 01512 95z" fill="var(--red-1, #ff5252)"/></svg></div><div class=loading-word>少女祈祷中...</div></div></div></div><script>var time=null,startLoading=()=>{time=Date.now(),document.getElementById("loader").classList.remove("loading")},endLoading=()=>{time?Date.now()-time>500?(time=null,document.body.style.overflow="auto",document.getElementById("loader").classList.add("loading")):(setTimeout(endLoading,500-(Date.now()-time)),time=null):(document.body.style.overflow="auto",document.getElementById("loader").classList.add("loading"))};window.addEventListener("DOMContentLoaded",endLoading),document.getElementById("loader").addEventListener("click",endLoading)</script><div id=copy-tooltip style="pointer-events:none;opacity:0;transition:all .2s ease;position:fixed;top:50%;left:50%;z-index:999;transform:translate(-50%,-50%);color:#fff;background:rgba(0,0,0,.5);padding:10px 15px;border-radius:10px"></div><div id=lang-tooltip style="pointer-events:none;opacity:0;transition:all .2s ease;position:fixed;top:50%;left:50%;z-index:999;transform:translate(-50%,-50%);color:#fff;background:rgba(0,0,0,.5);padding:10px 15px;border-radius:10px">本文章没有找到对应的语言版本</div><div id=heatmap-tooltip></div><div id=container><div id=wrap><div id=header-nav><nav id=main-nav><span class=main-nav-link-wrap><div class='main-nav-icon icon rotate'>&#xe62b;</div><a class=main-nav-link href=/lanke-hugo.github.io/>首页</a>
</span><span class=main-nav-link-wrap><div class='main-nav-icon icon rotate'>&#xe62b;</div><a class=main-nav-link href=/lanke-hugo.github.io/archives>归档</a>
</span><span class=main-nav-link-wrap><div class='main-nav-icon icon rotate'>&#xe62b;</div><a class=main-nav-link href=/lanke-hugo.github.io/about>关于</a>
</span><span class=main-nav-link-wrap><div class='main-nav-icon icon rotate'>&#xe62b;</div><a class=main-nav-link href=/lanke-hugo.github.io/friend>友链</a>
</span><a id=main-nav-toggle class=nav-icon></a></nav><nav id=sub-nav></nav></div><header id=header><picture></picture><img fetchpriority=high src=/lanke-hugo.github.io/images/banner.jpg alt=QAX笔记><div id=header-outer><div id=header-title><a href=/lanke-hugo.github.io/ id=logo><h1 data-aos=slide-up>QAX笔记</h1></a><h2 id=subtitle-wrap data-aos=slide-down></h2></div></div></header><div id=content class=sidebar-right><aside id=sidebar><div class="sidebar-wrapper wrap-sticky"><div class=sidebar-wrap data-aos=fade-up><div class=sidebar-toc-sidebar><div class=sidebar-toc><h3 class=toc-title>文章目录</h3><div class="sidebar-toc-wrapper toc-div-class"><nav id=TableOfContents><ul><li><a href=#一后台服务>一、后台服务</a><ul><li></li></ul></li><li><a href=#二接口>二、接口</a><ul><li></li></ul></li><li><a href=#三git>三、git</a><ul><li></li></ul></li><li><a href=#四dockyard>四、Dockyard</a><ul><li><a href=#1新增服务>1.新增服务</a></li><li><a href=#2迭代分支>2.迭代分支</a></li></ul></li><li><a href=#五数据库>五、数据库</a><ul><li></li></ul></li><li><a href=#六常用>六、常用</a><ul><li></li></ul></li></ul></nav></div></div></div><div class="sidebar-common-sidebar hidden"><div class=sidebar-author><img data-src=/lanke-hugo.github.io/avatar/../images/avatar.jpg data-sizes=auto alt=烂柯 class=lazyload><div class=sidebar-author-name>烂柯</div><div class=sidebar-description>江海寄尔生...</div></div><div class=sidebar-state><div class=sidebar-state-article><div>文章</div><div class=sidebar-state-number>10</div></div><a class=sidebar-state-category href=/lanke-hugo.github.io/categories/ aria-label=sidebar-state-category-link><div>分类</div><div class=sidebar-state-number>11</div></a><a class=sidebar-state-tag href=/lanke-hugo.github.io/tags/ aria-label=sidebar-state-tag-link><div>标签</div><div class=sidebar-state-number>17</div></a></div><div class=sidebar-social></div><div class=sidebar-menu><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=/lanke-hugo.github.io/ aria-label=首页></a><div class='sidebar-menu-icon icon rotate'>&#xe62b;</div><div class=sidebar-menu-link>首页</div></div><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=/lanke-hugo.github.io/archives aria-label=归档></a><div class='sidebar-menu-icon icon rotate'>&#xe62b;</div><div class=sidebar-menu-link>归档</div></div><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=/lanke-hugo.github.io/about aria-label=关于></a><div class='sidebar-menu-icon icon rotate'>&#xe62b;</div><div class=sidebar-menu-link>关于</div></div><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=/lanke-hugo.github.io/friend aria-label=友链></a><div class='sidebar-menu-icon icon rotate'>&#xe62b;</div><div class=sidebar-menu-link>友链</div></div></div></div><div class=sidebar-btn-wrapper style=position:static><div class="sidebar-toc-btn current"></div><div class=sidebar-common-btn></div></div></div></div><div class=sidebar-widget></div></aside><section id=main><article class="h-entry article" itemprop=blogPost itemscope itemtype=https://schema.org/BlogPosting><div class=article-inner data-aos=fade-up><div class=article-meta><div class=article-date><span class=article-date-link data-aos=zoom-in><time datetime="2025-09-10 00:00:00 +0000 UTC" itemprop=datePublished>2025-09-10</time>
<time style=display:none id=post-update-time>2025-12-04</time></span></div><div class=article-category><a class=article-category-link href=/lanke-hugo.github.io/categories/work-book data-aos=zoom-in>WORK BOOK</a></div></div><div class=hr-line></div><div class="e-content article-entry" itemprop=articleBody><h1 id=笔记><a class=header-anchor href=#%e7%ac%94%e8%ae%b0></a>笔记</h1><p>常看笔记
<a href=https://www.bookstack.cn/books/effective-java-3rd-chinese>https://www.bookstack.cn/books/effective-java-3rd-chinese</a></p><h2 id=一后台服务><a class=header-anchor href=#%e4%b8%80%e5%90%8e%e5%8f%b0%e6%9c%8d%e5%8a%a1></a>一、后台服务</h2><h4 id=1打包部署><a class=header-anchor href=#1%e6%89%93%e5%8c%85%e9%83%a8%e7%bd%b2></a>1.打包部署</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>在gitlub中的Tags中new一个tag，命名     v1.0-alpha.16  -------&gt;  v1.0-alpha.17
</span></span><span class=line><span class=cl>1、cd /data/s/services/dayu_config/dayu-confs/configs/
</span></span><span class=line><span class=cl>2、vim mods/服务名/artifact/alpha.ini
</span></span><span class=line><span class=cl>3、cd /data/s/services/dayu_config/dayu-confs/configs/ &amp;&amp; rg -e single _secret-ukey
</span></span><span class=line><span class=cl>4、kubectl get pod  -n dev | grep secret-ukey
</span></span><span class=line><span class=cl>kubectl get pod | grep secret-ukey
</span></span><span class=line><span class=cl>5、查看日志：kubectl logs -f --tail=100 data-transmission-66b8bf7558-dxnsn -n dev
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>重启服务：（直接删pod）
</span></span><span class=line><span class=cl>kubectl delete pod 服务名
</span></span></code></pre></div><h4 id=2打一键升级包><a class=header-anchor href=#2%e6%89%93%e4%b8%80%e9%94%ae%e5%8d%87%e7%ba%a7%e5%8c%85></a>2.打一键升级包</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>参考文档：
</span></span><span class=line><span class=cl>https://cooperate-sop-doc-situation-situation-sop-8fb60afe02c747db4e8e5.doc-biz.qianxin-inc.cn/develop/overall/dev/upgrade-template.html
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>账号密码：
</span></span><span class=line><span class=cl>situation-af
</span></span><span class=line><span class=cl>hcK%R*UJXeYesYsw2023
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>(1)添加物料
</span></span><span class=line><span class=cl>1.在images.txt中加入镜像
</span></span><span class=line><span class=cl>2.设置compressTarGz.sh中PROJECT_NAME(命名规则为 态势大版本号加上项目简称，例如：R3.10.6_LNWX)
</span></span><span class=line><span class=cl>3./pre_other：发布服务之前需要执行的内容，通过脚本执行。
</span></span><span class=line><span class=cl>    /init_db：存放需要额外执行的sql，sql文件名字与数据库名保持一致
</span></span><span class=line><span class=cl>    /dict：需要导入到玄机字典文件，xls文件
</span></span><span class=line><span class=cl>    /asset_field：资产扩展字段文件，json文件
</span></span><span class=line><span class=cl>  /mods：本次需要升级的mods文件
</span></span><span class=line><span class=cl>  /post_other：发布服务之后需要执行的内容，通过脚本执行
</span></span><span class=line><span class=cl>  /zeus_file：zeus权限文件
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>(2)将文件拉到后台服务中
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>(3)赋予执行权限
</span></span><span class=line><span class=cl>chmod +x compressTarGz.sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>(4)执行脚本
</span></span><span class=line><span class=cl>./compressTarGz.sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>(5)现场执行
</span></span><span class=line><span class=cl>1.tar -zxvf R3.10.6_BJGD_update_20250822132538.tar.gz
</span></span><span class=line><span class=cl>2.cd R3.10.6_BJGD_update_20250822132538/
</span></span><span class=line><span class=cl>3.bash upgrade.sh
</span></span><span class=line><span class=cl>4.查看服务是否起来
</span></span></code></pre></div><h4 id=3命令><a class=header-anchor href=#3%e5%91%bd%e4%bb%a4></a>3.命令</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>ll</span><span class=o>/</span><span class=n>ls</span>
</span></span><span class=line><span class=cl><span class=n>cat</span> <span class=n>beta</span><span class=o>.</span><span class=n>ini</span>
</span></span><span class=line><span class=cl><span class=n>cat</span> <span class=n>alpha</span><span class=o>.</span><span class=n>ini</span> <span class=o>&gt;</span> <span class=n>beta</span><span class=o>.</span><span class=n>ini</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>docker</span> <span class=n>pull</span> <span class=n>situation</span><span class=o>-</span><span class=n>docker</span><span class=o>-</span><span class=n>alpha</span><span class=o>.</span><span class=n>af</span><span class=o>-</span><span class=n>biz</span><span class=o>.</span><span class=n>qianxin</span><span class=o>-</span><span class=n>inc</span><span class=o>.</span><span class=n>cn</span><span class=o>/</span><span class=n>secret</span><span class=o>-</span><span class=n>ukey</span><span class=p>:</span><span class=mf>6134.0</span><span class=o>.</span><span class=mf>18.</span><span class=n>fjwx</span><span class=o>-</span><span class=n>alpha</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>1.</span><span class=err>查看用</span><span class=n>x86还是arm</span><span class=err>：</span>
</span></span><span class=line><span class=cl><span class=n>uname</span> <span class=o>-</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=err>查看服务</span><span class=n>ip</span><span class=err>：</span>
</span></span><span class=line><span class=cl><span class=n>hostname</span> <span class=o>-</span><span class=n>i</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>2.</span><span class=err>查看</span><span class=n>cm</span><span class=err>：（</span><span class=n>config</span><span class=o>-</span><span class=n>map</span><span class=err>）</span>
</span></span><span class=line><span class=cl><span class=n>kubectl</span> <span class=n>describe</span> <span class=n>cm</span> <span class=n>gateway</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>3.</span><span class=err>查看服务：</span>
</span></span><span class=line><span class=cl><span class=n>kubectl</span> <span class=n>get</span> <span class=n>pod</span> <span class=err>（默认进去命名空间的</span><span class=n>default</span><span class=err>）</span>
</span></span><span class=line><span class=cl><span class=n>kubectl</span> <span class=n>get</span> <span class=n>cn</span><span class=err>（查看命名空间，包含</span><span class=n>default</span><span class=err>）</span>
</span></span><span class=line><span class=cl><span class=n>kubectl</span> <span class=n>get</span> <span class=n>pod</span> <span class=o>-</span><span class=n>n</span> <span class=n>uae</span><span class=o>-</span><span class=n>flink</span><span class=o>-</span><span class=n>single</span><span class=err>（进去其他命名空间）</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>4.</span><span class=err>查看服务版本号：（镜像服务名：</span><span class=n>situation</span><span class=o>...</span><span class=err>）</span>
</span></span><span class=line><span class=cl><span class=n>kubectl</span> <span class=n>describe</span> <span class=n>pod</span> <span class=err>服务名</span>  <span class=o>|</span> <span class=n>grep</span> <span class=ne>Image</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>5.</span><span class=err>查看服务资源：</span>
</span></span><span class=line><span class=cl><span class=n>kubectl</span> <span class=n>get</span> <span class=n>svc</span> <span class=o>|</span> <span class=n>grep</span> <span class=n>hakkero</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>6.</span><span class=err>修改服务资源：</span>
</span></span><span class=line><span class=cl><span class=n>kubectl</span> <span class=n>edit</span> <span class=n>svc</span> <span class=n>hakkero</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>7.</span><span class=err>改状态机：</span>
</span></span><span class=line><span class=cl><span class=n>kubectl</span> <span class=n>edit</span> <span class=n>svc</span> <span class=n>hakkero</span>
</span></span><span class=line><span class=cl><span class=n>type</span><span class=p>:</span> <span class=n>ClusterIP</span> <span class=err>改为</span> <span class=n>NodePort</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>8.</span><span class=err>查看文件：</span>
</span></span><span class=line><span class=cl><span class=n>cat</span> <span class=err>文件名</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>9.</span><span class=err>在目录下创建文件夹：</span>
</span></span><span class=line><span class=cl><span class=n>mkdir</span> <span class=err>目录名</span>
</span></span><span class=line><span class=cl><span class=n>touch</span> <span class=err>文件名</span><span class=o>.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>10.</span><span class=err>进入文件：</span>
</span></span><span class=line><span class=cl><span class=n>vim</span> <span class=err>文件路径</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>11.</span><span class=err>删除文件</span>
</span></span><span class=line><span class=cl><span class=err>（</span><span class=mi>1</span><span class=err>）进到目录下</span>
</span></span><span class=line><span class=cl><span class=err>（</span><span class=mi>2</span><span class=err>）</span><span class=n>rm</span> <span class=o>-</span><span class=n>rf</span> <span class=o>./</span><span class=err>文件名</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>12.</span><span class=err>复制文件：</span>
</span></span><span class=line><span class=cl><span class=n>cp</span> <span class=o>./</span><span class=n>add_incident</span><span class=o>.</span><span class=n>yaml</span> <span class=n>add_incident</span><span class=o>.</span><span class=n>yaml111</span><span class=err>（本目录下）</span>
</span></span><span class=line><span class=cl><span class=n>cp</span> <span class=o>./</span><span class=n>add_incident_1001</span><span class=o>.</span><span class=n>yaml</span>  <span class=o>/</span><span class=n>data</span><span class=o>/</span><span class=n>s</span><span class=o>/</span><span class=n>services</span><span class=o>/</span><span class=n>ts_config</span><span class=o>/</span><span class=n>ts</span><span class=o>-</span><span class=n>zeus</span><span class=o>/</span><span class=err>（新目录下）</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>13.</span><span class=err>运行可执行文件：</span>
</span></span><span class=line><span class=cl><span class=err>（</span><span class=mi>1</span><span class=err>）到目录下</span>    <span class=o>/</span><span class=n>data</span><span class=o>/</span><span class=n>s</span><span class=o>/</span><span class=n>services</span><span class=o>/</span><span class=n>ts_config</span><span class=o>/</span><span class=n>ts</span><span class=o>-</span><span class=n>zeus</span>
</span></span><span class=line><span class=cl><span class=err>（</span><span class=mi>2</span><span class=err>）执行</span>      <span class=o>./</span><span class=n>zeus</span><span class=o>-</span><span class=n>permission</span><span class=o>-</span><span class=n>sdk</span> <span class=o>-</span><span class=n>path</span> <span class=n>add_weave_plan</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>14.</span><span class=err>查看</span><span class=n>user</span><span class=o>-</span><span class=n>info信息</span><span class=err>：</span>
</span></span><span class=line><span class=cl><span class=n>kubectl</span> <span class=n>logs</span> <span class=o>-</span><span class=n>f</span> <span class=n>gateway</span><span class=o>-</span><span class=mi>6856965</span><span class=n>d9f</span><span class=o>-</span><span class=mi>7</span><span class=n>ckww</span> <span class=o>|</span> <span class=n>grep</span> <span class=n>user</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>15.</span><span class=err>网关</span><span class=n>pod</span><span class=err>：</span>
</span></span><span class=line><span class=cl><span class=n>kubectl</span> <span class=n>get</span> <span class=n>pod</span> <span class=o>|</span> <span class=n>grep</span> <span class=n>gate</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>16.</span><span class=err>后台服务查数据库：</span>
</span></span><span class=line><span class=cl><span class=k>export</span> <span class=n>PGPASSWORD</span><span class=o>=</span><span class=s1>&#39;A7GaKXT3JEY3_Qrh&#39;</span> <span class=o>&amp;&amp;</span> <span class=o>/</span><span class=n>data</span><span class=o>/</span><span class=n>s</span><span class=o>/</span><span class=n>services</span><span class=o>/</span><span class=n>pgsql</span><span class=o>/</span><span class=n>server</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>psql</span> <span class=o>-</span><span class=n>U</span> <span class=n>postgres</span> <span class=o>-</span><span class=n>p</span> <span class=mi>15432</span> <span class=o>-</span><span class=n>d</span> <span class=n>postgres</span><span class=p>(</span><span class=err>数据库名</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>17.</span><span class=err>连接数据库</span><span class=n>ip加白名单</span>
</span></span><span class=line><span class=cl><span class=n>iptables</span> <span class=o>-</span><span class=n>I</span> <span class=n>INPUT</span> <span class=mi>1</span> <span class=o>-</span><span class=n>s</span>  <span class=mf>10.43</span><span class=o>.</span><span class=mf>185.114</span> <span class=o>-</span><span class=n>p</span> <span class=n>tcp</span> <span class=o>-</span><span class=n>j</span> <span class=n>ACCEPT</span>
</span></span><span class=line><span class=cl><span class=n>iptables</span> <span class=o>-</span><span class=n>I</span> <span class=n>INPUT</span> <span class=o>-</span><span class=n>s</span> <span class=mf>10.43</span><span class=o>.</span><span class=mf>185.114</span> <span class=o>-</span><span class=n>j</span> <span class=n>ACCEPT</span>
</span></span><span class=line><span class=cl><span class=n>iptables</span> <span class=o>-</span><span class=n>t</span> <span class=n>mangle</span> <span class=o>-</span><span class=n>I</span> <span class=n>PREROUTING</span> <span class=o>-</span><span class=n>s</span> <span class=mf>10.43</span><span class=o>.</span><span class=mf>185.114</span> <span class=o>-</span><span class=n>j</span> <span class=n>ACCEPT</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>18.</span><span class=err>进入</span><span class=n>k8s容器</span><span class=err>：</span>
</span></span><span class=line><span class=cl><span class=n>kubectl</span> <span class=n>exec</span> <span class=o>-</span><span class=n>it</span> <span class=n>framework</span><span class=o>-</span><span class=n>message</span><span class=o>-</span><span class=n>center</span><span class=o>-</span><span class=mi>5</span><span class=n>b5f676c6d</span><span class=o>-</span><span class=n>mj9l7</span> <span class=o>--</span> <span class=n>bash</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>19.</span><span class=err>查看分布在哪个节点：</span>
</span></span><span class=line><span class=cl><span class=n>kubectl</span> <span class=n>get</span> <span class=n>pod</span> <span class=o>-</span><span class=n>o</span> <span class=n>wide</span> <span class=o>|</span> <span class=n>grep</span> <span class=n>app</span>
</span></span><span class=line><span class=cl><span class=err>查看系统</span><span class=n>hosts文件内容</span><span class=p>(</span><span class=err>包含节点</span><span class=n>ip</span><span class=p>):</span>
</span></span><span class=line><span class=cl><span class=n>cat</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>hosts</span>
</span></span><span class=line><span class=cl><span class=err>查看服务的端口号信息</span>
</span></span><span class=line><span class=cl><span class=n>kubectl</span> <span class=n>get</span> <span class=n>svc</span> <span class=o>|</span> <span class=n>grep</span> <span class=n>analysis</span><span class=o>-</span><span class=n>search</span>
</span></span><span class=line><span class=cl><span class=err>修改配置文件暴露服务端口</span>  <span class=err>将该配置属性改</span><span class=n>type</span><span class=p>:</span> <span class=n>ClusterIP修为NodePort</span>
</span></span><span class=line><span class=cl><span class=n>kubectl</span> <span class=n>edit</span> <span class=n>svc</span> <span class=n>analysis</span><span class=o>-</span><span class=n>search</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>查看</span><span class=n>k8s集群节点信息</span><span class=err>：</span>
</span></span><span class=line><span class=cl><span class=n>kubectl</span> <span class=n>get</span> <span class=n>nodes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>20.</span><span class=err>查看日志：</span>
</span></span><span class=line><span class=cl><span class=n>kubectl</span> <span class=n>logs</span> <span class=n>framework</span><span class=o>-</span><span class=n>message</span><span class=o>-</span><span class=n>center</span><span class=o>-</span><span class=mi>6</span><span class=n>bb87f68cf</span><span class=o>-</span><span class=mi>6</span><span class=n>q8r4</span> <span class=o>|</span> <span class=n>grep</span> <span class=o>-</span><span class=n>C</span> <span class=mi>20</span> <span class=s1>&#39;GENIF202509227&#39;</span>
</span></span></code></pre></div><h4 id=4后台账号><a class=header-anchor href=#4%e5%90%8e%e5%8f%b0%e8%b4%a6%e5%8f%b7></a>4.后台账号</h4><p><code>situation-configs/platform/env_single/cluster.ini</code></p><h4 id=5后台配置文件><a class=header-anchor href=#5%e5%90%8e%e5%8f%b0%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6></a>5.后台配置文件</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1.后台服务配置文件：（mods/服务名/sys-res/sys_res-reuse.yml）
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>needle:
</span></span><span class=line><span class=cl>  audit:
</span></span><span class=line><span class=cl>    topic: dayu_audit
</span></span><span class=line><span class=cl>    kafka: {{ .Values.config.envKafkaBrokers | join &#34;,&#34; }}
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>2.给网关加白：（mods/gateway/values.yaml）
</span></span><span class=line><span class=cl>uaa:
</span></span><span class=line><span class=cl>  enable: true
</span></span><span class=line><span class=cl>  ignore-url:
</span></span><span class=line><span class=cl>    - /dayu/v1/asset/defenceSystem/synData
</span></span></code></pre></div><h2 id=二接口><a class=header-anchor href=#%e4%ba%8c%e6%8e%a5%e5%8f%a3></a>二、接口</h2><h4 id=1接口注解注意事项><a class=header-anchor href=#1%e6%8e%a5%e5%8f%a3%e6%b3%a8%e8%a7%a3%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9></a>1.接口注解注意事项</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>getMapping请求参数为 `对象` 时不能用@RequestBody，用@SpringQueryMap
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>getMapping请求参数为 `单个值` 是用@RequestParam
</span></span><span class=line><span class=cl>注：@RequestParam(value = &#34;org_no&#34;, required = false) String orgNo
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>getMapping请求参数在路径上用@PathVariable
</span></span></code></pre></div><h4 id=2api接口注解><a class=header-anchor href=#2api%e6%8e%a5%e5%8f%a3%e6%b3%a8%e8%a7%a3></a>2.API接口注解</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>对象参数
</span></span><span class=line><span class=cl>@Schema(description = &#34;组织机构编码&#34;)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>controller层上
</span></span><span class=line><span class=cl>@Tag(name = &#34;MT安全机构&#34;)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>接口上
</span></span><span class=line><span class=cl>@Operation(summary = &#34;组织名称为公司的列表接口&#34;)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>传参
</span></span><span class=line><span class=cl>@Parameter(description = &#34;组织名称&#34;, required = true)
</span></span><span class=line><span class=cl>eg：
</span></span><span class=line><span class=cl>public List&lt;OrgCompanyResultDto&gt; orgNameList(@Parameter(description = &#34;组织名称&#34;, required = true) @RequestParam(value = &#34;org_name&#34;, required = false) String orgName){}
</span></span></code></pre></div><h4 id=3实体类注解><a class=header-anchor href=#3%e5%ae%9e%e4%bd%93%e7%b1%bb%e6%b3%a8%e8%a7%a3></a>3.实体类注解</h4><p>updateById（T entity）和removeById(T entity)</p><p>实体类主键id要加**@Table**注解</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@TableId</span><span class=p>(</span><span class=n>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;org_no&#34;</span><span class=p>,</span><span class=w> </span><span class=n>type</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>IdType</span><span class=p>.</span><span class=na>NONE</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>type类型</span><span class=err>（</span><span class=n>默认AUTO</span><span class=err>）</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>AUTO</span><span class=w>            </span><span class=n>数据库自增</span><span class=err>，</span><span class=n>可以手动赋值</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>NONE</span><span class=w>            </span><span class=n>无策略</span><span class=err>，</span><span class=n>手动赋值</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>INPUT</span><span class=w>           </span><span class=n>必须手动赋值</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ASSIGN_ID</span><span class=w>       </span><span class=n>雪花算法生成Long类型</span><span class=err>，</span><span class=n>可以手动赋值</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ASSIGN_UUID</span><span class=w>     </span><span class=n>生成UUID字符串</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//  @Builder、@NoArgsConstructor、@AllArgsConstructor最好一块使用</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//  单独使用@Builder赋值时可能因为没有无参构造方法报错</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@TableName</span><span class=p>(</span><span class=s>&#34;app_business&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Builder</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@NoArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@AllArgsConstructor</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//需要给数据库赋null值，实体类是加 @TableField 注解</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@TableField</span><span class=p>(</span><span class=n>updateStrategy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>FieldStrategy</span><span class=p>.</span><span class=na>IGNORED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>IGNORED</span><span class=w>         </span><span class=n>已弃用的策略</span><span class=err>，</span><span class=n>表示忽略字段的默认行为</span><span class=err>。</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ALWAYS</span><span class=w>          </span><span class=n>总是包含该字段</span><span class=err>，</span><span class=n>无论其值如何</span><span class=err>，</span><span class=n>都会参与数据库操作</span><span class=err>。</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>NOT_NULL</span><span class=w>        </span><span class=n>当字段值不为</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=n>时</span><span class=err>，</span><span class=n>才包含该字段参与数据库操作</span><span class=err>。</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>NOT_EMPTY</span><span class=w>       </span><span class=n>当字段值不为空</span><span class=err>（</span><span class=n>通常指不为</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=n>且不为空字符串</span><span class=err>）</span><span class=n>时</span><span class=err>，</span><span class=n>才包含该字段参与数据库操作</span><span class=err>。</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>DEFAULT</span><span class=w>         </span><span class=n>使用默认策略</span><span class=err>，</span><span class=n>通常根据字段的默认值或其他默认规则来决定是否包含该字段</span><span class=err>。</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>NEVER</span><span class=w>           </span><span class=n>从不包含该字段</span><span class=err>，</span><span class=n>即该字段不会参与任何数据库操作</span><span class=err>。</span><span class=w>
</span></span></span></code></pre></div><h2 id=三git><a class=header-anchor href=#%e4%b8%89git></a>三、git</h2><h4 id=1配置dayuv1路径----提测需要加上><a class=header-anchor href=#1%e9%85%8d%e7%bd%aedayuv1%e8%b7%af%e5%be%84----%e6%8f%90%e6%b5%8b%e9%9c%80%e8%a6%81%e5%8a%a0%e4%b8%8a></a>1.配置dayu/v1路径 (提测需要加上)</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>前端加dayu/v1配置
</span></span><span class=line><span class=cl>dockyard服务端部署配置找git（开发分支）
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>1.mods/服务名
</span></span><span class=line><span class=cl>（1）如果提测后，/values.yaml中alpha改为beta
</span></span><span class=line><span class=cl>image:
</span></span><span class=line><span class=cl>  repository: situation-docker-alpha.af-biz.qianxin-inc.cn
</span></span><span class=line><span class=cl>中的alpha改为beta
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2.mods/gateway/values.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>3.mods/dayu_mods.rgl
</span></span><span class=line><span class=cl>（1）在mod taishi下flow _all加上服务名
</span></span><span class=line><span class=cl>（2）flow _服务名 : _flow_begin,${C1},${M1} : vega_flow._helm {
</span></span><span class=line><span class=cl>      pkg = &#34;服务名&#34;; SERVICE_PREFIX  = &#34;/服务名&#34; ;
</span></span><span class=line><span class=cl>   }
</span></span></code></pre></div><h4 id=2查询代码行数><a class=header-anchor href=#2%e6%9f%a5%e8%af%a2%e4%bb%a3%e7%a0%81%e8%a1%8c%e6%95%b0></a>2.查询代码行数</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>git log --author=&#34;L-zhangliming&#34; --format=&#39;%aN&#39; | sort -u | while read name; do
</span></span><span class=line><span class=cl>    echo -en &#34;$name\t&#34;; 
</span></span><span class=line><span class=cl>    git log --author=&#34;$name&#34; --pretty=tformat: --since=2025-09-05 --until=2025-09-11 --numstat | awk &#39;{ add += $1; subs += $2; loc += $1 - $2 } END { printf &#34;added lines: %s, removed lines: %s, total lines: %s\n&#34;, add, subs, loc }&#39;;
</span></span><span class=line><span class=cl>done
</span></span></code></pre></div><h2 id=四dockyard><a class=header-anchor href=#%e5%9b%9bdockyard></a>四、Dockyard</h2><h3 id=1新增服务><a class=header-anchor href=#1%e6%96%b0%e5%a2%9e%e6%9c%8d%e5%8a%a1></a>1.新增服务</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>模块管理 -&gt; 微服务管理 -&gt; 新增服务
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>微服务所属产品： 态势感知-第一事业部
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>微服务名称： 服务名(中文)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>微服务标识： 服务名+后缀名   （项目管理 -&gt; 全部项目 -&gt; 后缀名    后缀名一般C开头）
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>微服务创建方式： 关联已存在的Git仓库
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>微服务类型： situation-program
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Gitlab Group: situation/situation-java-program/situation-program
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>选择已存在的 Git 仓库: 输入服务名会自动出来
</span></span></code></pre></div><h3 id=2迭代分支><a class=header-anchor href=#2%e8%bf%ad%e4%bb%a3%e5%88%86%e6%94%af></a>2.迭代分支</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>微服务右上角按钮 -&gt; 迭代版本 -&gt; 创建迭代版本
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>迭代类型: Custom
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>基准类型: 基准版本
</span></span></code></pre></div><h2 id=五数据库><a class=header-anchor href=#%e4%ba%94%e6%95%b0%e6%8d%ae%e5%ba%93></a>五、数据库</h2><h4 id=1连接数据库ip加白名单><a class=header-anchor href=#1%e8%bf%9e%e6%8e%a5%e6%95%b0%e6%8d%ae%e5%ba%93ip%e5%8a%a0%e7%99%bd%e5%90%8d%e5%8d%95></a>1.连接数据库ip加白名单</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>iptables -I INPUT 1 -s  10.43.185.114 -p tcp -j ACCEPT
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>iptables -I INPUT -s 10.111.14.70 -j ACCEPT
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>iptables -t mangle -I PREROUTING -s 10.111.14.70 -j ACCEPT
</span></span></code></pre></div><h4 id=2pg数据库id自增><a class=header-anchor href=#2pg%e6%95%b0%e6%8d%ae%e5%ba%93id%e8%87%aa%e5%a2%9e></a>2.pg数据库id自增</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>-- 创建序列
</span></span><span class=line><span class=cl>CREATE SEQUENCE t_traceability_ip_id_seq;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>-- 修改字段默认值（让字段具备自增能力）
</span></span><span class=line><span class=cl>ALTER TABLE t_traceability_ip
</span></span><span class=line><span class=cl>    ALTER COLUMN id SET DEFAULT nextval(&#39;t_traceability_ip_id_seq&#39;);
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>-- 修改自增序号
</span></span><span class=line><span class=cl>SELECT setval(&#39;t_traceability_ip_id_seq&#39;, (SELECT MAX(id) FROM t_traceability_ip) + 1);
</span></span></code></pre></div><h4 id=3跨库表连接><a class=header-anchor href=#3%e8%b7%a8%e5%ba%93%e8%a1%a8%e8%bf%9e%e6%8e%a5></a>3.跨库表连接</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1.在写sql的数据库执行  SELECT * FROM pg_extension WHERE extname = &#39;dblink&#39;;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2.未安装则执行  CREATE EXTENSION IF NOT EXISTS dblink;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>3.写sql，在 bi 中 user=postgres 不允许写
</span></span><span class=line><span class=cl>SELECT 
</span></span><span class=line><span class=cl>    a.team_type,
</span></span><span class=line><span class=cl>    a.problem_type,s
</span></span><span class=line><span class=cl>    a.score,
</span></span><span class=line><span class=cl>    b.name
</span></span><span class=line><span class=cl>FROM attack_defense_info a
</span></span><span class=line><span class=cl>JOIN (
</span></span><span class=line><span class=cl>    SELECT id, name
</span></span><span class=line><span class=cl>    FROM dblink(&#39;dbname=governance user=postgres password=A7GaKXT3JEY3_Qrh host=10.57.146.31 port=15432&#39;,
</span></span><span class=line><span class=cl>                &#39;SELECT id, name FROM organization&#39;)
</span></span><span class=line><span class=cl>    AS remote_table(id int8, name VARCHAR)
</span></span><span class=line><span class=cl>) b ON a.org::BIGINT = b.id
</span></span></code></pre></div><h4 id=4后台服务查数据库><a class=header-anchor href=#4%e5%90%8e%e5%8f%b0%e6%9c%8d%e5%8a%a1%e6%9f%a5%e6%95%b0%e6%8d%ae%e5%ba%93></a>4.后台服务查数据库</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=k>export</span> <span class=n>PGPASSWORD</span><span class=o>=</span><span class=s1>&#39;A7GaKXT3JEY3_Qrh&#39;</span> <span class=o>&amp;&amp;</span> <span class=o>/</span><span class=n>data</span><span class=o>/</span><span class=n>s</span><span class=o>/</span><span class=n>services</span><span class=o>/</span><span class=n>pgsql</span><span class=o>/</span><span class=n>server</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>psql</span> <span class=o>-</span><span class=n>U</span> <span class=n>postgres</span> <span class=o>-</span><span class=n>p</span> <span class=mi>15432</span> <span class=o>-</span><span class=n>d</span> <span class=n>postgres</span><span class=p>(</span><span class=err>数据库名</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>PGPASSWORD</span> <span class=n>pg数据库密码</span>
</span></span><span class=line><span class=cl><span class=o>&amp;&amp;</span> <span class=err>表示前一个命令执行成功后继续执行</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>data</span><span class=o>/</span><span class=n>s</span><span class=o>/</span><span class=n>services</span><span class=o>/</span><span class=n>pgsql</span><span class=o>/</span><span class=n>server</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>psql</span><span class=err>：</span><span class=n>PostgreSQL</span> <span class=err>的命令行客户端工具</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>U</span> <span class=n>postgres</span><span class=err>：以用户</span> <span class=n>postgres</span> <span class=err>身份登录（</span><span class=n>PostgreSQL</span> <span class=err>的默认超级用户）</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>p</span> <span class=mi>15432</span><span class=err>：连接数据库的端口号为</span> <span class=mi>15432</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>d</span> <span class=n>postgres</span><span class=err>：连接的数据库名称为</span> <span class=n>postgres</span><span class=err>（默认系统数据库）</span>
</span></span></code></pre></div><h4 id=5coalesce合并><a class=header-anchor href=#5coalesce%e5%90%88%e5%b9%b6></a>5.COALESCE（合并）</h4><p>原理：从左到右依次查找不为null的参数</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>select COALESCE(null,&#39;a&#39;,&#39;b&#39;)...        返回a
</span></span><span class=line><span class=cl>select COALESCE(user_name,&#39;abc&#39;)...     user_name不为null，返回它的值，为null，返回abc
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>eg：
</span></span><span class=line><span class=cl>WITH
</span></span><span class=line><span class=cl>        tddr AS (
</span></span><span class=line><span class=cl>        SELECT task_id, COUNT(*) AS disposal_frequency
</span></span><span class=line><span class=cl>        FROM t_ddos_disposal_result where api_type = &#39;5.5.3&#39;
</span></span><span class=line><span class=cl>        GROUP BY task_id
</span></span><span class=line><span class=cl>        )
</span></span><span class=line><span class=cl>        SELECT DISTINCT
</span></span><span class=line><span class=cl>        tdai.task_id,
</span></span><span class=line><span class=cl>        tdai.task_name,
</span></span><span class=line><span class=cl>        tdai.user_id,
</span></span><span class=line><span class=cl>        tdai.ddos_task_type,
</span></span><span class=line><span class=cl>        tdai.task_duration,
</span></span><span class=line><span class=cl>        tdai.task_level,
</span></span><span class=line><span class=cl>        tdai.task_status,
</span></span><span class=line><span class=cl>        tdai.create_time,
</span></span><span class=line><span class=cl>        tdai.disposal_start_time,
</span></span><span class=line><span class=cl>        tdai.disposal_end_time,
</span></span><span class=line><span class=cl>        tdai.user_examine,
</span></span><span class=line><span class=cl>        tdai.ip_number,
</span></span><span class=line><span class=cl>        COALESCE(tddr.disposal_frequency, 0) AS disposal_frequency
</span></span><span class=line><span class=cl>        FROM
</span></span><span class=line><span class=cl>        t_ddos_attack_info tdai
</span></span><span class=line><span class=cl>        LEFT JOIN tddr ON tdai.task_id = tddr.task_id
</span></span><span class=line><span class=cl>        left join t_ddos_ip tdi on tdai.task_id = tdi.task_id
</span></span></code></pre></div><h2 id=六常用><a class=header-anchor href=#%e5%85%ad%e5%b8%b8%e7%94%a8></a>六、常用</h2><h4 id=1代码规范><a class=header-anchor href=#1%e4%bb%a3%e7%a0%81%e8%a7%84%e8%8c%83></a>1.代码规范</h4><p><code>Shift+Ctrl+Alt+L</code></p><p><code>Ctrl+Alt+L</code></p><h4 id=2值为空抛异常><a class=header-anchor href=#2%e5%80%bc%e4%b8%ba%e7%a9%ba%e6%8a%9b%e5%bc%82%e5%b8%b8></a>2.值为空抛异常</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>第一种：
</span></span><span class=line><span class=cl>1.在实体类上加注解@NotBlank
</span></span><span class=line><span class=cl>@NotBlank(message = &#34;任务名称不能为空&#34;)
</span></span><span class=line><span class=cl>2.在controller层加注解@Valid
</span></span><span class=line><span class=cl>eg：public Boolean createTraceability(@Valid @RequestBody TraceabilityInfoDto traceabilityInfoDto){}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>第二种：
</span></span><span class=line><span class=cl>if (traceabilityInfoDto.getUserExamine() == null || traceabilityInfoDto.getUserExamine().isEmpty()) {
</span></span><span class=line><span class=cl>            throw new BaseException(HttpStatus.INTERNAL, &#34;user_examine&#34;, &#34;任务审核人不能为空&#34;);
</span></span><span class=line><span class=cl>        }
</span></span></code></pre></div><h4 id=3long类型序列化><a class=header-anchor href=#3long%e7%b1%bb%e5%9e%8b%e5%ba%8f%e5%88%97%e5%8c%96></a>3.long类型序列化</h4><p><code>@JsonSerialize(using = ToStringSerializer.class)</code></p><h4 id=4远程调用><a class=header-anchor href=#4%e8%bf%9c%e7%a8%8b%e8%b0%83%e7%94%a8></a>4.远程调用</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>启动类
</span></span><span class=line><span class=cl>@EnableFeignClients
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>@FeignClient(url = &#34;${feign.governance:http://governance:8080}&#34;, value = &#34;${feign.governance:http://governance:8080}&#34;)
</span></span><span class=line><span class=cl>public interface GovernanceClient {
</span></span><span class=line><span class=cl>    @PostMapping(&#34;governance/organization/list&#34;)
</span></span><span class=line><span class=cl>    List&lt;JSONObject&gt; list(@RequestBody OrgListRequest request);
</span></span><span class=line><span class=cl>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># feign相关配置</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>feign</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>httpclient</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>disable-ssl-validation</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>okhttp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>unit</span><span class=p>:</span><span class=w> </span><span class=l>http://governance:8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># feign相关配置(本地)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>feign</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>unit</span><span class=p>:</span><span class=w> </span><span class=l>http://10.52.120.33:31323 </span><span class=w> </span><span class=c># 31323在服务中用 kubectl get svc | grep ... 找</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>hystrix</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>  
</span></span></span></code></pre></div><h4 id=5isblank和isempty区别><a class=header-anchor href=#5isblank%e5%92%8cisempty%e5%8c%ba%e5%88%ab></a>5.isBlank和isEmpty区别</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>a = null;
</span></span><span class=line><span class=cl>b = &#34;&#34;;
</span></span><span class=line><span class=cl>c = &#34;   &#34;;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>isBlank(a)、isBlank(b)、isBlank(c)为true
</span></span><span class=line><span class=cl>isEmpty(a)、isEmpty(b)为true，isEmpty(c)为false
</span></span></code></pre></div><h4 id=6常用工具类><a class=header-anchor href=#6%e5%b8%b8%e7%94%a8%e5%b7%a5%e5%85%b7%e7%b1%bb></a>6.常用工具类</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>StrUtil工具类    String
</span></span><span class=line><span class=cl>StrUtil.isNotEmpty()
</span></span><span class=line><span class=cl>StrUtil.isNotBlank()
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>CollUtil工具类    集合
</span></span><span class=line><span class=cl>CollUtil.isNotEmpty
</span></span><span class=line><span class=cl>CollUtil.newArrayList()
</span></span><span class=line><span class=cl>CollUtil.emptyIfNull(list)  list为null，工具类将null转为空集合，避免空指针异常
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Collections工具类
</span></span><span class=line><span class=cl>Collections.emptyList();  返回空list集合，不能进行任何操作
</span></span></code></pre></div><h4 id=7tag初始化><a class=header-anchor href=#7tag%e5%88%9d%e5%a7%8b%e5%8c%96></a>7.Tag初始化</h4><p>1.git操作：在部署分支上的init_scripts目录下的3-sql，将tag.sql文件放进去</p><p>2.idea操作：配置ymal文件，config.java文件要与flyway中的配置对应</p><h4 id=8添加tag标签><a class=header-anchor href=#8%e6%b7%bb%e5%8a%a0tag%e6%a0%87%e7%ad%be></a>8.添加Tag标签</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=err>数据库运行语句</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=k>public</span><span class=p>.</span><span class=n>tag_group</span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>description</span><span class=p>,</span><span class=w> </span><span class=n>created_time</span><span class=p>,</span><span class=w> </span><span class=n>updated_time</span><span class=p>,</span><span class=w> </span><span class=n>deleted_time</span><span class=p>,</span><span class=w> </span><span class=n>app</span><span class=p>,</span><span class=w> </span><span class=n>is_preset</span><span class=p>,</span><span class=w> </span><span class=n>is_default</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                             </span><span class=n>is_accessed</span><span class=p>,</span><span class=w> </span><span class=n>classification</span><span class=p>,</span><span class=w> </span><span class=n>sort</span><span class=p>,</span><span class=w> </span><span class=n>can_edit</span><span class=p>,</span><span class=w> </span><span class=n>can_delete</span><span class=p>,</span><span class=w> </span><span class=n>can_add_child</span><span class=p>,</span><span class=w> </span><span class=n>can_add_partner</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                             </span><span class=n>can_add_tag</span><span class=p>,</span><span class=w> </span><span class=n>path</span><span class=p>,</span><span class=w> </span><span class=n>parent_id</span><span class=p>,</span><span class=w> </span><span class=n>app_name</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;预置分组&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;attack_defense_report&#39;</span><span class=p>,</span><span class=w> </span><span class=k>true</span><span class=p>,</span><span class=w> </span><span class=k>true</span><span class=p>,</span><span class=w> </span><span class=k>false</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;报告类型&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=k>false</span><span class=p>,</span><span class=w> </span><span class=k>false</span><span class=p>,</span><span class=w> </span><span class=k>true</span><span class=p>,</span><span class=w> </span><span class=k>true</span><span class=p>,</span><span class=w> </span><span class=k>true</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>null</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;攻防综合管理&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=s2>&#34;public&#34;</span><span class=p>.</span><span class=s2>&#34;tag&#34;</span><span class=p>(</span><span class=s2>&#34;name&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;description&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;created_time&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;updated_time&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;deleted_time&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;is_preset&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;app&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                           </span><span class=s2>&#34;group_id&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;is_read_only&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;color_code&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;can_edit&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;can_delete&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;is_disabled&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                           </span><span class=s2>&#34;properties&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;user_code&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;工具依赖风险&#39;</span><span class=p>,</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;2025-04-24 00:00:00.000&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;2025-04-24 00:00:00.000&#39;</span><span class=p>,</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;t&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;attack_defense&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>tag_group</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>NAME</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;问题类型&#39;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>app</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;attack_defense&#39;</span><span class=p>),</span><span class=w> </span><span class=s1>&#39;f&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;#4C9ADF&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;t&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;f&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;f&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;sw&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>ON</span><span class=w> </span><span class=n>conflict</span><span class=w> </span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=n>app</span><span class=p>)</span><span class=w> </span><span class=k>DO</span><span class=w> </span><span class=k>NOTHING</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h4 id=9flywayid自增序列bigserial><a class=header-anchor href=#9flywayid%e8%87%aa%e5%a2%9e%e5%ba%8f%e5%88%97bigserial></a>9.Flyway+id自增序列（bigserial）</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>org.flywaydb<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>flyway-core<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>spring</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>flyway</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c>#    flyway 的 clean 命令会删除指定 schema 下的所有 table, 杀伤力太大了, 应该禁掉.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>clean-disabled</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c>#    禁用/启用flyway</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c>#    设定 SQL 脚本的目录,多个路径使用逗号分隔, 比如取值为 classpath:db/migration,filesystem:/sql-migrations</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>locations</span><span class=p>:</span><span class=w> </span><span class=l>classpath:db/migration/postgres</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c>#    如果指定 schema 包含了其他表,但没有 flyway schema history 表的话, 在执行 flyway migrate 命令之前, 必须先执行 flyway baseline 命令.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>baseline-on-migrate</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c>#    指定 baseline 的版本号,缺省值为 1, 低于该版本号的 SQL 文件, migrate 的时候被忽略.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>baseline-version</span><span class=p>:</span><span class=w> </span><span class=m>1.0.101</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c>#    sql文件编码</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>encoding</span><span class=p>:</span><span class=w> </span><span class=l>UTF-8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c>#    开发环境最好开启 outOfOrder, 生产环境关闭 outOfOrder .</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>out-of-order</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>baseline-description</span><span class=p>:</span><span class=w> </span><span class=l>baseline init</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>table</span><span class=p>:</span><span class=w> </span><span class=l>flyway_third_party_integration_history</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>-- 创建序列
</span></span><span class=line><span class=cl>CREATE SEQUENCE t_traceability_ip_id_seq;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>-- 修改字段默认值（让字段具备自增能力）
</span></span><span class=line><span class=cl>ALTER TABLE t_traceability_ip
</span></span><span class=line><span class=cl>    ALTER COLUMN id SET DEFAULT nextval(&#39;t_traceability_ip_id_seq&#39;);
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>-- 修改自增序号
</span></span><span class=line><span class=cl>SELECT setval(&#39;t_traceability_ip_id_seq&#39;, (SELECT MAX(id) FROM t_traceability_ip) + 1);
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// primary key 主键</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>create</span><span class=w> </span><span class=n>table</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=n>not</span><span class=w> </span><span class=n>exists</span><span class=w> </span><span class=kd>public</span><span class=p>.</span><span class=na>send_mdm_org</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>org_no</span><span class=w>                    </span><span class=nf>varchar</span><span class=p>(</span><span class=n>32</span><span class=p>)</span><span class=w> </span><span class=n>NOT</span><span class=w> </span><span class=n>NULL</span><span class=w> </span><span class=n>primary</span><span class=w> </span><span class=n>key</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>org_name</span><span class=w>                  </span><span class=nf>varchar</span><span class=p>(</span><span class=n>100</span><span class=p>)</span><span class=w> </span><span class=n>NOT</span><span class=w> </span><span class=n>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// bigserial 序列</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>create</span><span class=w> </span><span class=n>table</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=n>not</span><span class=w> </span><span class=n>exists</span><span class=w> </span><span class=kd>public</span><span class=p>.</span><span class=na>send_mdm_org</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>org_no</span><span class=w>                    </span><span class=n>bigserial</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>org_name</span><span class=w>                  </span><span class=nf>varchar</span><span class=p>(</span><span class=n>100</span><span class=p>)</span><span class=w> </span><span class=n>NOT</span><span class=w> </span><span class=n>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>注</span><span class=err>：</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>tag_name</span><span class=w>     </span><span class=nf>varchar</span><span class=p>(</span><span class=n>255</span><span class=p>)</span><span class=w> </span><span class=n>COLLATE</span><span class=w> </span><span class=n>pg_catalog</span><span class=p>.</span><span class=s>&#34;default&#34;</span><span class=w> </span><span class=n>NOT</span><span class=w> </span><span class=n>NULL</span><span class=w>    </span><span class=err>√</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>tag_name</span><span class=w>     </span><span class=nf>varchar</span><span class=p>(</span><span class=n>255</span><span class=p>)</span><span class=w> </span><span class=n>COLLATE</span><span class=w> </span><span class=n>NOT</span><span class=w> </span><span class=n>NULL</span><span class=w>                         </span><span class=err>×</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>COLLATE</span><span class=w> </span><span class=n>pg_catalog</span><span class=p>.</span><span class=s>&#34;default&#34;</span><span class=w> </span><span class=n>collate排序</span><span class=err>，</span><span class=n>要加后面的pg_catalog</span><span class=p>.</span><span class=s>&#34;default&#34;</span><span class=w>
</span></span></span></code></pre></div><h4 id=10导入导出><a class=header-anchor href=#10%e5%af%bc%e5%85%a5%e5%af%bc%e5%87%ba></a>10.导入导出</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=c>&lt;!-- pom.xml --&gt;</span>
</span></span><span class=line><span class=cl><span class=c>&lt;!--Excel数据导出 --&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>com.alibaba<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>easyexcel<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;version&gt;</span>3.0.5<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;exclusions&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;exclusion&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>org.apache.commons<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>commons-compress<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/exclusion&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/exclusions&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>org.apache.commons<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>commons-compress<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;version&gt;</span>1.21<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//controller</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Operation</span><span class=p>(</span><span class=n>description</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;导出数据&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@PostMapping</span><span class=p>(</span><span class=s>&#34;/file/export&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>export</span><span class=p>(</span><span class=nd>@Parameter</span><span class=p>(</span><span class=n>description</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;导出&#34;</span><span class=p>,</span><span class=w> </span><span class=n>required</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                   </span><span class=n>HttpServletResponse</span><span class=w> </span><span class=n>response</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>appBindingPersonService</span><span class=p>.</span><span class=na>export</span><span class=p>(</span><span class=n>response</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Operation</span><span class=p>(</span><span class=n>description</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;导入数据&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@PostMapping</span><span class=p>(</span><span class=s>&#34;/file/import&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>importData</span><span class=p>(</span><span class=nd>@Parameter</span><span class=p>(</span><span class=n>description</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;导入&#34;</span><span class=p>,</span><span class=w> </span><span class=n>required</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=nd>@RequestParam</span><span class=p>(</span><span class=s>&#34;file&#34;</span><span class=p>)</span><span class=w> </span><span class=n>MultipartFile</span><span class=w> </span><span class=n>file</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>appBindingPersonService</span><span class=p>.</span><span class=na>importData</span><span class=p>(</span><span class=n>file</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h5 id=1导出><a class=header-anchor href=#1%e5%af%bc%e5%87%ba></a>（1）导出</h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//dto</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>package</span><span class=w> </span><span class=nn>com.qax.situation.mt.imaotai.app.infra.common.excel</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>lombok.Data</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.List</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ExcelMultiSheetDto</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * sheet名称
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>sheetName</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 数据类型（用于生成表头）
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Class</span><span class=o>&lt;?&gt;</span><span class=w> </span><span class=n>dataClass</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 导出的数据列表
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>List</span><span class=o>&lt;?&gt;</span><span class=w> </span><span class=n>dataList</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//Util</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>package</span><span class=w> </span><span class=nn>com.qax.situation.mt.imaotai.app.infra.common.excel</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.alibaba.excel.EasyExcel</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.alibaba.excel.write.builder.ExcelWriterBuilder</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>javax.servlet.http.HttpServletResponse</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.io.IOException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.net.URLEncoder</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.List</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Excel导出工具类
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ExcelExportUtil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>exportExcel</span><span class=p>(</span><span class=n>HttpServletResponse</span><span class=w> </span><span class=n>response</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>fileName</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                       </span><span class=n>List</span><span class=o>&lt;</span><span class=n>ExcelMultiSheetDto</span><span class=o>&gt;</span><span class=w> </span><span class=n>sheetList</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>IOException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 设置响应头</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>response</span><span class=p>.</span><span class=na>setContentType</span><span class=p>(</span><span class=s>&#34;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>response</span><span class=p>.</span><span class=na>setCharacterEncoding</span><span class=p>(</span><span class=s>&#34;utf-8&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 防止中文乱码</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>fileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>URLEncoder</span><span class=p>.</span><span class=na>encode</span><span class=p>(</span><span class=n>fileName</span><span class=p>,</span><span class=w> </span><span class=s>&#34;UTF-8&#34;</span><span class=p>).</span><span class=na>replaceAll</span><span class=p>(</span><span class=s>&#34;\\+&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;%20&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>response</span><span class=p>.</span><span class=na>setHeader</span><span class=p>(</span><span class=s>&#34;Content-disposition&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;attachment;filename*=utf-8&#39;&#39;&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>fileName</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;.xlsx&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 写出数据</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ExcelWriterBuilder</span><span class=w> </span><span class=n>writerBuilder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>EasyExcel</span><span class=p>.</span><span class=na>write</span><span class=p>(</span><span class=n>response</span><span class=p>.</span><span class=na>getOutputStream</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>ExcelMultiSheetDto</span><span class=w> </span><span class=n>sheetDTO</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>sheetList</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>writerBuilder</span><span class=p>.</span><span class=na>head</span><span class=p>(</span><span class=n>sheetDTO</span><span class=p>.</span><span class=na>getDataClass</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>sheet</span><span class=p>(</span><span class=n>sheetDTO</span><span class=p>.</span><span class=na>getSheetName</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>doWrite</span><span class=p>(</span><span class=n>sheetDTO</span><span class=p>.</span><span class=na>getDataList</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//impl</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Transactional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>export</span><span class=p>(</span><span class=n>HttpServletResponse</span><span class=w> </span><span class=n>response</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>QueryWrapper</span><span class=o>&lt;</span><span class=n>AppBindingPersonPo</span><span class=o>&gt;</span><span class=w> </span><span class=n>queryWrapper</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>QueryWrapper</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>queryWrapper</span><span class=p>.</span><span class=na>and</span><span class=p>(</span><span class=n>wrapper</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>wrapper</span><span class=p>.</span><span class=na>isNull</span><span class=p>(</span><span class=s>&#34;app_account&#34;</span><span class=p>).</span><span class=na>or</span><span class=p>().</span><span class=na>eq</span><span class=p>(</span><span class=s>&#34;app_account&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>AppBindingPersonPo</span><span class=o>&gt;</span><span class=w> </span><span class=n>personList</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>appBindingPersonRepository</span><span class=p>.</span><span class=na>list</span><span class=p>(</span><span class=n>queryWrapper</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>FileDto</span><span class=o>&gt;</span><span class=w> </span><span class=n>list</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>FileDto</span><span class=p>.</span><span class=na>convert</span><span class=p>(</span><span class=n>personList</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>ExcelMultiSheetDto</span><span class=o>&gt;</span><span class=w> </span><span class=n>sheetList</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ExcelMultiSheetDto</span><span class=w> </span><span class=n>sheet</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ExcelMultiSheetDto</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>sheet</span><span class=p>.</span><span class=na>setSheetName</span><span class=p>(</span><span class=s>&#34;用户列表&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>sheet</span><span class=p>.</span><span class=na>setDataClass</span><span class=p>(</span><span class=n>FileDto</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>sheet</span><span class=p>.</span><span class=na>setDataList</span><span class=p>(</span><span class=n>list</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>sheetList</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>sheet</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//填充数据</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ExcelExportUtil</span><span class=p>.</span><span class=na>exportExcel</span><span class=p>(</span><span class=n>response</span><span class=p>,</span><span class=w> </span><span class=s>&#34;未绑定人员数据导出&#34;</span><span class=p>,</span><span class=w> </span><span class=n>sheetList</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>IOException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>log</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;导出异常：&#34;</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h5 id=2导入><a class=header-anchor href=#2%e5%af%bc%e5%85%a5></a>（2）导入</h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//util 监听器</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>package</span><span class=w> </span><span class=nn>com.qax.situation.mt.imaotai.app.infra.common.excel</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>cn.hutool.core.collection.CollUtil</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>cn.hutool.core.util.ObjectUtil</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.alibaba.excel.context.AnalysisContext</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.alibaba.excel.event.AnalysisEventListener</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.baomidou.mybatisplus.core.conditions.query.QueryWrapper</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.qax.situation.mt.imaotai.app.domain.repository.AppBindingPersonRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.qax.situation.mt.imaotai.app.infra.persistence.entity.AppBindingPersonPo</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.qax.situation.mt.imaotai.app.application.dto.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>lombok.extern.slf4j.Slf4j</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.stereotype.Component</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>javax.annotation.Resource</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.ArrayList</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.List</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Excel导入监听器
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @param &lt;T&gt;
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Slf4j</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ImportListener</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>AnalysisEventListener</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Resource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>AppBindingPersonRepository</span><span class=w> </span><span class=n>appBindingPersonRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=n>list</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>invoke</span><span class=p>(</span><span class=n>T</span><span class=w> </span><span class=n>t</span><span class=p>,</span><span class=w> </span><span class=n>AnalysisContext</span><span class=w> </span><span class=n>analysisContext</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>t</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>list</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>t</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>doAfterAllAnalysed</span><span class=p>(</span><span class=n>AnalysisContext</span><span class=w> </span><span class=n>analysisContext</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>AppBindingPersonPo</span><span class=o>&gt;</span><span class=w> </span><span class=n>updateList</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>T</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>list</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>FileDto</span><span class=w> </span><span class=n>dto</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>FileDto</span><span class=p>)</span><span class=w> </span><span class=n>t</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>QueryWrapper</span><span class=o>&lt;</span><span class=n>AppBindingPersonPo</span><span class=o>&gt;</span><span class=w> </span><span class=n>queryWrapper</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>QueryWrapper</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>queryWrapper</span><span class=p>.</span><span class=na>eq</span><span class=p>(</span><span class=s>&#34;relation_account&#34;</span><span class=p>,</span><span class=w> </span><span class=n>dto</span><span class=p>.</span><span class=na>getRelationAccount</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>AppBindingPersonPo</span><span class=w> </span><span class=n>po</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>appBindingPersonRepository</span><span class=p>.</span><span class=na>getOne</span><span class=p>(</span><span class=n>queryWrapper</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>ObjectUtil</span><span class=p>.</span><span class=na>isNotEmpty</span><span class=p>(</span><span class=n>po</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>po</span><span class=p>.</span><span class=na>setAppAccount</span><span class=p>(</span><span class=n>dto</span><span class=p>.</span><span class=na>getAppAccount</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>updateList</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>po</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>CollUtil</span><span class=p>.</span><span class=na>isNotEmpty</span><span class=p>(</span><span class=n>updateList</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>appBindingPersonRepository</span><span class=p>.</span><span class=na>updateBatchById</span><span class=p>(</span><span class=n>updateList</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>list</span><span class=p>.</span><span class=na>clear</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//impl</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Transactional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>importData</span><span class=p>(</span><span class=n>MultipartFile</span><span class=w> </span><span class=n>file</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>Objects</span><span class=p>.</span><span class=na>isNull</span><span class=p>(</span><span class=n>file</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>BaseException</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>INTERNAL</span><span class=p>,</span><span class=w> </span><span class=s>&#34;MultipartFile&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;请选择文件&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>suffix</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>FileUtil</span><span class=p>.</span><span class=na>getSuffix</span><span class=p>(</span><span class=n>file</span><span class=p>.</span><span class=na>getOriginalFilename</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=s>&#34;xlsx&#34;</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>suffix</span><span class=p>)</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>!</span><span class=s>&#34;xls&#34;</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>suffix</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>BaseException</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>INTERNAL</span><span class=p>,</span><span class=w> </span><span class=s>&#34;MultipartFile&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;请选择Excel文件&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ImportListener</span><span class=w> </span><span class=n>importListener</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>applicationContext</span><span class=p>.</span><span class=na>getBean</span><span class=p>(</span><span class=n>ImportListener</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>EasyExcel</span><span class=p>.</span><span class=na>read</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>file</span><span class=p>.</span><span class=na>getInputStream</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>FileDto</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>importListener</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>).</span><span class=na>sheet</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>doRead</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=s>&#34;导入成功&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>IOException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>log</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;导入异常：&#34;</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=s>&#34;导入失败&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h4 id=11获取bean实例><a class=header-anchor href=#11%e8%8e%b7%e5%8f%96bean%e5%ae%9e%e4%be%8b></a>11.获取Bean实例</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>// 方式1: 按类型获取（当前使用的方式）
</span></span><span class=line><span class=cl>ImportListener listener = applicationContext.getBean(ImportListener.class);
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// 方式2: 按名称获取
</span></span><span class=line><span class=cl>ImportListener listener = applicationContext.getBean(&#34;importListener&#34;,
</span></span><span class=line><span class=cl>ImportListener.class);
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// 方式3: 按名称获取（返回Object类型，需要强转）
</span></span><span class=line><span class=cl>ImportListener listener = (ImportListener) applicationContext.getBean(&#34;importListener&#34;);
</span></span></code></pre></div></div><footer class=article-footer><ul class=article-tag-list itemprop=keywords><li class=article-tag-list-item data-aos=zoom-in><a class=article-tag-list-link href=/lanke-hugo.github.io/tags/work-book rel=tag>WORK BOOK</a></li></ul></footer></div><nav id=article-nav data-aos=fade-up><div class="article-nav-link-wrap article-nav-link-left"><img data-src=https://d-sketon.top/img/_backwebp/bg4.webp data-sizes=auto alt=QAX个人工作笔记 class=lazyload><a href=/lanke-hugo.github.io/post/a-qax%E7%AC%94%E8%AE%B0/></a><div class=article-nav-caption>前一篇</div><h3 class=article-nav-title>QAX个人工作笔记</h3></div><div class="article-nav-link-wrap article-nav-link-right"><img data-src=https://d-sketon.top/img/_backwebp/bg1.webp data-sizes=auto alt=Typora使用示例 class=lazyload><a href=/lanke-hugo.github.io/post/typora%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B/></a><div class=article-nav-caption>后一篇</div><h3 class=article-nav-title>Typora使用示例</h3></div></nav></article></section></div><footer id=footer><div style=width:100%;overflow:hidden><div class=footer-line></div></div><div id=footer-info><div><span class=icon-copyright></span>2020-2025<span class="footer-info-sep rotate"></span>
烂柯</div><div>基于&nbsp;<a href=https://gohugo.io/ target=_blank>Hugo</a>&nbsp; Theme.<a href=https://github.com/D-Sketon/hugo-theme-reimu target=_blank>Reimu</a></div><div><span class=icon-brush>&nbsp;10.6k</span>
&nbsp;|&nbsp;
<span class=icon-coffee>&nbsp;00:26</span></div><div><span class=icon-eye></span>
<span id=busuanzi_container_site_pv>总访问量&nbsp;<span id=busuanzi_value_site_pv></span></span>
&nbsp;|&nbsp;
<span class=icon-user></span>
<span id=busuanzi_container_site_uv>总访客量&nbsp;<span id=busuanzi_value_site_uv></span></span></div></div></footer><div class=sidebar-top><div class="sidebar-top-taichi rotate"></div><div class=arrow-up></div></div><div id=mask class=hide></div></div><nav id=mobile-nav><div class=sidebar-wrap><div class=sidebar-toc-sidebar><div class=sidebar-toc><h3 class=toc-title>文章目录</h3><div class="sidebar-toc-wrapper toc-div-class"><nav id=TableOfContents><ul><li><a href=#一后台服务>一、后台服务</a><ul><li></li></ul></li><li><a href=#二接口>二、接口</a><ul><li></li></ul></li><li><a href=#三git>三、git</a><ul><li></li></ul></li><li><a href=#四dockyard>四、Dockyard</a><ul><li><a href=#1新增服务>1.新增服务</a></li><li><a href=#2迭代分支>2.迭代分支</a></li></ul></li><li><a href=#五数据库>五、数据库</a><ul><li></li></ul></li><li><a href=#六常用>六、常用</a><ul><li></li></ul></li></ul></nav></div></div></div><div class="sidebar-common-sidebar hidden"><div class=sidebar-author><img data-src=/lanke-hugo.github.io/avatar/../images/avatar.jpg data-sizes=auto alt=烂柯 class=lazyload><div class=sidebar-author-name>烂柯</div><div class=sidebar-description>江海寄尔生...</div></div><div class=sidebar-state><div class=sidebar-state-article><div>文章</div><div class=sidebar-state-number>10</div></div><a class=sidebar-state-category href=/lanke-hugo.github.io/categories/ aria-label=sidebar-state-category-link><div>分类</div><div class=sidebar-state-number>11</div></a><a class=sidebar-state-tag href=/lanke-hugo.github.io/tags/ aria-label=sidebar-state-tag-link><div>标签</div><div class=sidebar-state-number>17</div></a></div><div class=sidebar-social></div><div class=sidebar-menu><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=/lanke-hugo.github.io/ aria-label=首页></a><div class='sidebar-menu-icon icon rotate'>&#xe62b;</div><div class=sidebar-menu-link>首页</div></div><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=/lanke-hugo.github.io/archives aria-label=归档></a><div class='sidebar-menu-icon icon rotate'>&#xe62b;</div><div class=sidebar-menu-link>归档</div></div><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=/lanke-hugo.github.io/about aria-label=关于></a><div class='sidebar-menu-icon icon rotate'>&#xe62b;</div><div class=sidebar-menu-link>关于</div></div><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=/lanke-hugo.github.io/friend aria-label=友链></a><div class='sidebar-menu-icon icon rotate'>&#xe62b;</div><div class=sidebar-menu-link>友链</div></div></div></div></div><div class=sidebar-btn-wrapper><div class="sidebar-toc-btn current"></div><div class=sidebar-common-btn></div></div></nav></div><script src=https://npm.webcache.cn/lazysizes@5.3.2/lazysizes.min.js integrity=sha384-3gT/vsepWkfz/ff7PpWNUeMzeWoH3cDhm/A8jM7ouoAK0/fP/9bcHHR5kHq2nf+e crossorigin=anonymous></script><script src=https://npm.webcache.cn/clipboard@2.0.11/dist/clipboard.min.js integrity=sha384-J08i8An/QeARD9ExYpvphB8BsyOj3Gh2TSh1aLINKO3L0cMSH2dN3E22zFoXEi0Q crossorigin=anonymous></script><script src=/lanke-hugo.github.io/js/main.js integrity crossorigin=anonymous></script><script src=/lanke-hugo.github.io/js/aos.js integrity crossorigin=anonymous></script><script>var aosInit=()=>{AOS.init({duration:1e3,easing:"ease",once:!0,offset:50})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",aosInit):aosInit()</script><script src=/lanke-hugo.github.io/js/pjax_main.js integrity crossorigin=anonymous data-pjax></script><script src=https://npm.webcache.cn/mouse-firework@0.1.1/dist/index.umd.js integrity=sha384-8LyaidD9GPxQQgLJO/WRw/O2h3BoNq/ApI/ecpvM6RsrCz2qP2ppBXUKihP4V/2d crossorigin=anonymous></script><script>if(window.firework){const e=JSON.parse('{"excludeelements":["a","button"],"particles":[{"colors":["var(--red-1)","var(--red-2)","var(--red-3)","var(--red-4)"],"duration":[1200,1800],"easing":"easeOutExpo","move":["emit"],"number":20,"shape":"circle","shapeOptions":{"alpha":[0.3,0.5],"radius":[16,32]}},{"colors":["var(--red-0)"],"duration":[1200,1800],"easing":"easeOutExpo","move":["diffuse"],"number":1,"shape":"circle","shapeOptions":{"alpha":[0.2,0.5],"lineWidth":6,"radius":20}}]}');e.excludeElements=e.excludeelements,delete e.excludeelements,window.firework(e)}</script><div id=lazy-script><div><script data-pjax>window.REIMU_POST={author:"烂柯",title:"QAX笔记",url:"https://lan-ke-people.github.io/lanke-hugo.github.io/post/b-qax%E7%AC%94%E8%AE%B0/",description:"QAX笔记",cover:"https://lan-ke-people.github.io/lanke-hugo.github.io/images/banner.jpg"}</script><script src=/lanke-hugo.github.io/js/insert_highlight.js integrity crossorigin=anonymous data-pjax></script><script type=module data-pjax>const PhotoSwipeLightbox = (await safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe-lightbox.esm.min.js", "sha384-DiL6M\/gG\u002bwmTxmCRZyD1zee6lIhawn5TGvED0FOh7fXcN9B0aZ9dexSF\/N6lrZi\/")).default;const pswp = () => {
          if (_$$('.article-entry a.article-gallery-item').length > 0) {
            new PhotoSwipeLightbox({
              gallery: '.article-entry',
              children: 'a.article-gallery-item',pswpModule: () => safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8\u002boTJ7m3DfYEWX1fu1scuS4\u002bs")}).init();
          }
          if(_$$('.article-gallery a.article-gallery-item').length > 0) {
            new PhotoSwipeLightbox({
              gallery: '.article-gallery',
              children: 'a.article-gallery-item',pswpModule: () => safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8\u002boTJ7m3DfYEWX1fu1scuS4\u002bs")}).init();
          }
          window.lightboxStatus = 'done';
          window.removeEventListener('lightbox:ready', pswp);
        }
        if(window.lightboxStatus === 'ready') {
          pswp()
        } else {
          window.addEventListener('lightbox:ready', pswp);
        }
      </script></div></div><script src=https://npm.webcache.cn/busuanzi@2.3.0/bsz.pure.mini.js asyncintegrity=sha384-0M75wtSkhjIInv4coYlaJU83+OypaRCIq2SukQVQX04eGTCBXJDuWAbJet56id+S crossorigin=anonymous></script><script>"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(e=>{for(let t of e)t.unregister()})</script><script>const reimuCopyright=String.raw`
   ______     ______     __     __    __     __  __    
  /\  == \   /\  ___\   /\ \   /\ "-./  \   /\ \/\ \   
  \ \  __<   \ \  __\   \ \ \  \ \ \-./\ \  \ \ \_\ \  
   \ \_\ \_\  \ \_____\  \ \_\  \ \_\ \ \_\  \ \_____\ 
    \/_/ /_/   \/_____/   \/_/   \/_/  \/_/   \/_____/ 
                                                    
  `;console.log(String.raw`%c ${reimuCopyright}`,"color: #ff5252;"),console.log("%c Theme.Reimu %c https://github.com/D-Sketon/hugo-theme-reimu ","color: white; background: #ff5252; padding:5px 0;","padding:4px;border:1px solid #ff5252;")</script></body></html>